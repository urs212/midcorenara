<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>êµ­ê°€ ì „ìŸ & ë¬¸ì˜ ê´€ë¦¬</title>
<style>
body { font-family: Arial; background: #e6f0ff; padding: 20px; }
h1 { text-align: center; color: #003366; }
.country, .inquiry { background: white; padding: 15px; margin: 10px auto; max-width: 600px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
.admin-btn, .inquiry-btn { display: inline-block; margin: 0 10px; padding: 10px 15px; background: #0066cc; color: white; border-radius: 8px; cursor: pointer; }
#adminPanel, #inquiryPanel { display: none; background: white; padding: 20px; max-width: 600px; margin: 20px auto; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
input, textarea, button { width: 100%; margin-top: 10px; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
ul li button { margin-left: 10px; color: red; cursor: pointer; border:none; background:none; }
</style>
</head>
<body>

<h1>ğŸŒ êµ­ê°€ ì ë ¹ í˜„í™©</h1>
<div style="text-align:center;">
  <div class="admin-btn" onclick="adminLogin()">ê´€ë¦¬ì</div>
  <div class="inquiry-btn" onclick="openInquiry()">ë¬¸ì˜</div>
</div>

<div id="countries"></div>

<!-- ê´€ë¦¬ì íŒ¨ë„ -->
<div id="adminPanel">
    <h2>ê´€ë¦¬ì íŒ¨ë„</h2>

    <h3>êµ­ê°€ ì ë ¹ ê´€ë¦¬</h3>
    <input id="nation" placeholder="ë‚˜ë¼ ì´ë¦„ (ì˜ˆ: ë¯¸êµ­)">
    <textarea id="lands" placeholder="ì ë ¹í•œ ë‚˜ë¼ë“¤ (ì‰¼í‘œë¡œ êµ¬ë¶„)"></textarea>
    <button type="button" onclick="saveData()">ì €ì¥</button>

    <h3>ë¬¸ì˜ ê´€ë¦¬</h3>
    <div id="inquiriesList"></div>
</div>

<!-- ë¬¸ì˜ ì‘ì„± íŒ¨ë„ -->
<div id="inquiryPanel">
  <h2>ë¬¸ì˜ ì‘ì„±</h2>
  <form id="inquiryForm">
    <input id="inqNickname" placeholder="ë§ˆì¸í¬ë˜í”„íŠ¸ ë‹‰ë„¤ì„" required>
    <input id="inqRealname" placeholder="ì‹¤ëª…" required>
    <textarea id="inqContent" placeholder="ë¬¸ì˜ ë‚´ìš©" required></textarea>
    <button type="button" onclick="submitInquiry()">ë¬¸ì˜ ì œì¶œ</button>
  </form>
</div>

<script type="module">
// Firebase v9 ëª¨ë“ˆ
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCVQx91n67chn7SxFq16yXBkT5rMhG64Nk",
  authDomain: "midcoreserver-c0631.firebaseapp.com",
  databaseURL: "https://midcoreserver-c0631-default-rtdb.firebaseio.com",
  projectId: "midcoreserver-c0631",
  storageBucket: "midcoreserver-c0631.firebasestorage.app",
  messagingSenderId: "690934370848",
  appId: "1:690934370848:web:3f9b385fc293b5b7f36245",
  measurementId: "G-RRTHVNS986"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let isAdmin = false;
let lastCountryData = {};

// ================= êµ­ê°€ ì ë ¹ ê´€ë¦¬ =================
function adminLogin() {
  const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  if (pw === "suns0525") {
    isAdmin = true;
    document.getElementById("adminPanel").style.display = "block";
    renderCountries(lastCountryData);
    loadInquiries();
    alert("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”");
  } else alert("ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼");
}
window.adminLogin = adminLogin;

function saveData() {
  const nation = document.getElementById("nation").value.trim();
  const lands = document.getElementById("lands").value.split(",").map(v=>v.trim()).filter(v=>v!=="");
  if (!nation) { alert("ë‚˜ë¼ ì´ë¦„ ì…ë ¥"); return; }
  set(ref(db, "occupation/" + nation), lands);
  alert("ì €ì¥ ì™„ë£Œ");
}

function removeLand(nation, land) {
  if (!isAdmin) return;
  const nationRef = ref(db, "occupation/" + nation);
  onValue(nationRef, snapshot => {
    let lands = snapshot.val() || [];
    lands = lands.filter(l => l !== land);
    set(nationRef, lands);
  }, {onlyOnce:true});
}

// ì‹¤ì‹œê°„ ì ë ¹ í˜„í™©
const countriesDiv = document.getElementById("countries");
onValue(ref(db, "occupation"), snapshot => {
  lastCountryData = snapshot.val() || {};
  renderCountries(lastCountryData);
});

function renderCountries(data) {
  countriesDiv.innerHTML = "";
  for (const nation in data) {
    const div = document.createElement("div");
    div.className = "country";
    let html = `<h3>${nation}</h3><ul>`;
    if (data[nation].length===0) html += "<li>ì ë ¹í•œ ë‚˜ë¼ ì—†ìŒ</li>";
    else {
      data[nation].forEach(v=>{
        html += `<li>${v}`;
        if (isAdmin) html += ` <button onclick="removeLand('${nation}','${v}')">ì œê±°</button>`;
        html += `</li>`;
      });
    }
    html += "</ul>";
    div.innerHTML = html;
    countriesDiv.appendChild(div);
  }
}

// ================= ë¬¸ì˜ ê¸°ëŠ¥ =================
function openInquiry() {
  document.getElementById("inquiryPanel").style.display = "block";
}
window.openInquiry = openInquiry;

function submitInquiry() {
  const nickname = document.getElementById("inqNickname").value.trim();
  const realname = document.getElementById("inqRealname").value.trim();
  const content = document.getElementById("inqContent").value.trim();
  if(!nickname || !realname || !content) { alert("ëª¨ë“  í•­ëª© ì…ë ¥ í•„ìš”"); return; }

  push(ref(db, "inquiries"), {nickname, realname, content, answer:"", timestamp:Date.now()});
  alert("ë¬¸ì˜ ì œì¶œ ì™„ë£Œ");
  document.getElementById("inquiryForm").reset();
}

// ê´€ë¦¬ì: ë¬¸ì˜ ë¶ˆëŸ¬ì˜¤ê¸°
function loadInquiries() {
  onValue(ref(db, "inquiries"), snapshot=>{
    const data = snapshot.val() || {};
    const container = document.getElementById("inquiriesList");
    container.innerHTML = "";
    for (const id in data) {
      const inq = data[id];
      const div = document.createElement("div");
      div.className = "inquiry";
      div.innerHTML = `
        <b>${inq.nickname} (${inq.realname})</b><br>
        ${inq.content}<br>
        <b>ë‹µë³€:</b> <textarea id="ans-${id}">${inq.answer||""}</textarea>
        <button type="button" onclick="saveAnswer('${id}')">ë‹µë³€ ì €ì¥</button>
      `;
      container.appendChild(div);
    }
  });
}

function saveAnswer(id) {
  const answerText = document.getElementById(`ans-${id}`).value.trim();
  update(ref(db, "inquiries/" + id), {answer: answerText});
  alert("ë‹µë³€ ì €ì¥ ì™„ë£Œ");
}
window.saveAnswer = saveAnswer;

</script>
</body>
</html>
